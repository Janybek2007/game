<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="./styles.css" />
		<link rel="stylesheet" href="/styles/additional-style.css" />

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="/scripts/to-user.js"></script>
		<script src="/scripts/to-case.js"></script>
		<script src="./scripts.js"></script>

		<script>
			toUser(toUserProfileUI);
			toCase((caseData, items, headers) => {
				window.imageDict = items.map(itemData => ({
					id: itemData.id,
					name: itemData.name,
					url: itemData.image,
					price: itemData.price,
					rarityClass: getRarityClass(itemData.price)
				}));

				const caseInfoTitle = document.getElementById('caseTitle');
				const caseInfoImage = document.getElementById('startImage');
				if (caseInfoTitle) caseInfoTitle.textContent = caseData.name;
				if (caseInfoImage) caseInfoImage.src = caseData.image;

				const itemsGrid = document.getElementById('caseItemsContainer');
				itemsGrid.innerHTML = '';

				const sortedItems = [...caseData.items].sort((a, b) => {
					return parseFloat(b.item.price) - parseFloat(a.item.price);
				});

				sortedItems.forEach(itemData => {
					const item = itemData.item;
					let rarityClass = 'common';
					const price = parseFloat(item.price);
					if (price >= 5000) {
						rarityClass = 'legendary';
					} else if (price >= 1000) {
						rarityClass = 'epic';
					} else if (price >= 500) {
						rarityClass = 'rare';
					}

					const itemElement = document.createElement('div');
					itemElement.className = `item-card ${rarityClass}`;
					const imageUrl =
						item.item_image && item.item_image.length > 0
							? item.item_image[0].image
							: 'default-weapon.png';
					itemElement.innerHTML = `
						<div class="item-image-container">
							<img src="${imageUrl}" alt="${item.name}" class="item-image">
						</div>
						<div class="item-details">
							<h3 class="item-name">${item.name}</h3>
							<div class="item-price">${item.price}₽</div>
						</div>
					`;
					itemsGrid.appendChild(itemElement);
				});

				function getRarityClass(price) {
					let rarityClass = 'common';
					if (price >= 5000) {
						rarityClass = 'legendary';
					} else if (price >= 1000) {
						rarityClass = 'epic';
					} else if (price >= 500) {
						rarityClass = 'rare';
					}
					return rarityClass;
				}
				load(headers);
			});
		</script>
	</head>
	<body>
		<div class="layer1">
			<a
				href="https://jackhanmacsgolkgame.pythonanywhere.com/ru/steam/login"
				class="pressed-button steam-login-button"
			>
				<img src="/images/steam.svg" class="button-icon" alt="Steam Icon" />
				<h4 class="button-text">ВОЙТИ</h4>
			</a>
		</div>
		<a href="user.html" id="user-profile" class="user-profile hidden">
			<div class="profile-view">
				<div class="profile-avatar">
					<img id="user-avatar" src="" alt="User Avatar" />
				</div>
				<div class="profile-info">
					<div class="profile-nickname" id="user-nickname"></div>
					<div class="profile-balance" id="user-balance"></div>
				</div>
			</div>
		</a>
		<div class="container">
			<div class="case-info" id="caseInfo">
				<h1 id="caseTitle"></h1>
				<img id="startImage" src="" />
			</div>
			<div class="overlay" id="overlay"></div>

			<!-- Модальное окно с выигрышем -->
			<div id="winModal">
				<h2>Поздравляем!</h2>
				<img src="" alt="Приз" id="winImage" />
				<p id="winText"></p>
				<button id="closeWinBtn">Закрыть</button>
			</div>
			<div id="main" style="display: none">
				<div id="mxwidth">
					<ul id="boxes"></ul>
				</div>
				<div id="win"></div>
				<div id="win-bottom"></div>
			</div>
			<div class="open-case">
				<button id="startButton" class="button">Открыть</button>
				<button id="restartButton" class="button" style="display: none">
					Открыть занова
				</button>
			</div>
			<div id="loadingSpinner" class="spinner" style="display: none"></div>
			<div
				id="loadingText"
				style="
					display: none;
					text-align: center;
					color: white;
					margin-top: 15px;
					font-family: sans-serif;
					font-size: 15px;
					font-weight: bold;
					color: gray;
				"
			>
				ОТКРЫВАЕТСЯ
			</div>
			<h2 style="margin-bottom: 30px">СОДЕРЖИМОЕ КЕЙСА</h2>
			<div class="case-items" id="caseItemsContainer"></div>
		</div>
	</body>
</html>
